<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>IP/ROHC tunnel application: rohc_tunnel.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">IP/ROHC tunnel application
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_fdedb0aba14d44ce9d99bc100e026e6a.html">common</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">rohc_tunnel.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="session_8h_source.html">session.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ip__chksum_8h_source.html">ip_chksum.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br/>
<code>#include &quot;config.h&quot;</code><br/>
<code>#include &lt;assert.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;stdarg.h&gt;</code><br/>
<code>#include &lt;netinet/ip.h&gt;</code><br/>
<code>#include &lt;netinet/udp.h&gt;</code><br/>
<code>#include &lt;linux/if_tun.h&gt;</code><br/>
<code>#include &lt;net/ethernet.h&gt;</code><br/>
<code>#include &lt;sys/timerfd.h&gt;</code><br/>
<code>#include &lt;sys/epoll.h&gt;</code><br/>
</div><div class="textblock"><div class="dynheader">
Include dependency graph for rohc_tunnel.c:</div>
<div class="dyncontent">
<div class="center"><img src="rohc__tunnel_8c__incl.png" border="0" usemap="#rohc__tunnel_8c" alt=""/></div>
<map name="rohc__tunnel_8c" id="rohc__tunnel_8c">
</map>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab3ac238c50a8b19eda2b69313e44794e"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#ab3ac238c50a8b19eda2b69313e44794e">MAX_ROHC_SIZE</a>&#160;&#160;&#160;(5 * 1024)</td></tr>
<tr class="memdesc:ab3ac238c50a8b19eda2b69313e44794e"><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximal size of a ROHC packet.  <a href="#ab3ac238c50a8b19eda2b69313e44794e">More...</a><br/></td></tr>
<tr class="separator:ab3ac238c50a8b19eda2b69313e44794e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a239d3a6b08b199e7446a954696934e47"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a239d3a6b08b199e7446a954696934e47">MAX_TRACE_SIZE</a>&#160;&#160;&#160;2048</td></tr>
<tr class="separator:a239d3a6b08b199e7446a954696934e47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e4d0b1fa0a41b196c9bdc7aa0e2edbb"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a3e4d0b1fa0a41b196c9bdc7aa0e2edbb">LINUX_COOKED_HDR_LEN</a>&#160;&#160;&#160;16U</td></tr>
<tr class="separator:a3e4d0b1fa0a41b196c9bdc7aa0e2edbb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a23753d06dacd53e9933ecef97c1ee129"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a23753d06dacd53e9933ecef97c1ee129">tunnel_trace</a>(tunnel, prio, format,...)</td></tr>
<tr class="separator:a23753d06dacd53e9933ecef97c1ee129"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ad3f38ead0d7c208d577d03449fe73837"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#ad3f38ead0d7c208d577d03449fe73837">dump_packet</a> (char *descr, unsigned char *packet, unsigned int length)</td></tr>
<tr class="memdesc:ad3f38ead0d7c208d577d03449fe73837"><td class="mdescLeft">&#160;</td><td class="mdescRight">Display the content of a IP or ROHC packet.  <a href="#ad3f38ead0d7c208d577d03449fe73837">More...</a><br/></td></tr>
<tr class="separator:ad3f38ead0d7c208d577d03449fe73837"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca7867c745d02f334613e5e68edde1a9"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#aca7867c745d02f334613e5e68edde1a9">print_rohc_traces</a> (void *const priv_ctxt, const rohc_trace_level_t level, const rohc_trace_entity_t entity, const int profile, const char *format,...)</td></tr>
<tr class="memdesc:aca7867c745d02f334613e5e68edde1a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback to print traces of the ROHC library.  <a href="#aca7867c745d02f334613e5e68edde1a9">More...</a><br/></td></tr>
<tr class="separator:aca7867c745d02f334613e5e68edde1a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a13a458717d4b79d61e47d68b12bc61"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a9a13a458717d4b79d61e47d68b12bc61">callback_rtp_detect</a> (const unsigned char *const ip, const unsigned char *const udp, const unsigned char *const payload, const unsigned int payload_size, void *const rtp_private)</td></tr>
<tr class="memdesc:a9a13a458717d4b79d61e47d68b12bc61"><td class="mdescLeft">&#160;</td><td class="mdescRight">The RTP detection callback which do detect RTP stream.  <a href="#a9a13a458717d4b79d61e47d68b12bc61">More...</a><br/></td></tr>
<tr class="separator:a9a13a458717d4b79d61e47d68b12bc61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9cca9e8940dd975faa4a0d73cdac12b3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a9cca9e8940dd975faa4a0d73cdac12b3">send_puree</a> (int to, struct in_addr raddr, const size_t mtu, unsigned char *compressed_packet, size_t *total_size, size_t *act_comp, struct <a class="el" href="structstatitics.html">statitics</a> *stats)</td></tr>
<tr class="memdesc:a9cca9e8940dd975faa4a0d73cdac12b3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send the current packet.  <a href="#a9cca9e8940dd975faa4a0d73cdac12b3">More...</a><br/></td></tr>
<tr class="separator:a9cca9e8940dd975faa4a0d73cdac12b3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4e53dc18a89ea6070247e21051b694e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#ad4e53dc18a89ea6070247e21051b694e">raw2tun</a> (struct rohc_decomp *decomp, in_addr_t dst_addr, int from, int to, const size_t mtu, struct <a class="el" href="structstatitics.html">statitics</a> *stats)</td></tr>
<tr class="memdesc:ad4e53dc18a89ea6070247e21051b694e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forward ROHC packets received on the RAW socket to the TUN interface.  <a href="#ad4e53dc18a89ea6070247e21051b694e">More...</a><br/></td></tr>
<tr class="separator:ad4e53dc18a89ea6070247e21051b694e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a91ab7441fa2def288ea429cb229484bb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a91ab7441fa2def288ea429cb229484bb">tun2raw</a> (struct rohc_comp *comp, int from, int to, struct in_addr raddr, const size_t mtu, unsigned char *const packing_frame, const size_t packing_max_len, size_t *const packing_cur_len, const size_t packing_max_pkts, size_t *const packing_cur_pkts, struct <a class="el" href="structstatitics.html">statitics</a> *stats)</td></tr>
<tr class="memdesc:a91ab7441fa2def288ea429cb229484bb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Forward IP packets received on the TUN interface to the RAW socket.  <a href="#a91ab7441fa2def288ea429cb229484bb">More...</a><br/></td></tr>
<tr class="separator:a91ab7441fa2def288ea429cb229484bb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4287d18580f3733161df3e25e4fe11ac"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a4287d18580f3733161df3e25e4fe11ac">gnutls_transport_set_ptr_nowarn</a> (gnutls_session_t session, int ptr)</td></tr>
<tr class="separator:a4287d18580f3733161df3e25e4fe11ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14c44fc16206ae60d53a9650306ddee8"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a14c44fc16206ae60d53a9650306ddee8">gen_false_random_num</a> (const struct rohc_comp *const comp, void *const user_context)</td></tr>
<tr class="memdesc:a14c44fc16206ae60d53a9650306ddee8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generate a false random number for testing the ROHC library.  <a href="#a14c44fc16206ae60d53a9650306ddee8">More...</a><br/></td></tr>
<tr class="separator:a14c44fc16206ae60d53a9650306ddee8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a979506a2f8fea12f982622c384dc509e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a979506a2f8fea12f982622c384dc509e">iprohc_tunnel_new</a> (struct <a class="el" href="structiprohc__tunnel.html">iprohc_tunnel</a> *const tunnel, const struct <a class="el" href="structtunnel__params.html">tunnel_params</a> params, const uint32_t local_addr, const int raw_socket, const int tun_fd, const size_t base_dev_mtu, const size_t tun_dev_mtu)</td></tr>
<tr class="memdesc:a979506a2f8fea12f982622c384dc509e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the given tunnel context.  <a href="#a979506a2f8fea12f982622c384dc509e">More...</a><br/></td></tr>
<tr class="separator:a979506a2f8fea12f982622c384dc509e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1856ca8ec7babcd859baf97a836ff6f8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#a1856ca8ec7babcd859baf97a836ff6f8">iprohc_tunnel_free</a> (struct <a class="el" href="structiprohc__tunnel.html">iprohc_tunnel</a> *const tunnel)</td></tr>
<tr class="memdesc:a1856ca8ec7babcd859baf97a836ff6f8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the given tunnel context.  <a href="#a1856ca8ec7babcd859baf97a836ff6f8">More...</a><br/></td></tr>
<tr class="separator:a1856ca8ec7babcd859baf97a836ff6f8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3e0f62cf9f5b5ee048297babd224725"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rohc__tunnel_8c.html#ad3e0f62cf9f5b5ee048297babd224725">iprohc_tunnel_run</a> (void *arg)</td></tr>
<tr class="memdesc:ad3e0f62cf9f5b5ee048297babd224725"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start a new tunnel.  <a href="#ad3e0f62cf9f5b5ee048297babd224725">More...</a><br/></td></tr>
<tr class="separator:ad3e0f62cf9f5b5ee048297babd224725"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a3e4d0b1fa0a41b196c9bdc7aa0e2edbb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LINUX_COOKED_HDR_LEN&#160;&#160;&#160;16U</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ab3ac238c50a8b19eda2b69313e44794e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_ROHC_SIZE&#160;&#160;&#160;(5 * 1024)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The maximal size of a ROHC packet. </p>

</div>
</div>
<a class="anchor" id="a239d3a6b08b199e7446a954696934e47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_TRACE_SIZE&#160;&#160;&#160;2048</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a23753d06dacd53e9933ecef97c1ee129"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define tunnel_trace</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">tunnel, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">prio, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">format, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">do</span> \</div>
<div class="line">        { \</div>
<div class="line">                if((tunnel)-&gt;dst_addr_str[0] == <span class="charliteral">&#39;\0&#39;</span>) \</div>
<div class="line">                { <a class="code" href="log_8h.html#a2e3a398ef2790f21559e37a2a89bbed9">\</a></div>
<div class="line"><a class="code" href="log_8h.html#a2e3a398ef2790f21559e37a2a89bbed9">			trace</a>((prio), <span class="stringliteral">&quot;[client %s] &quot;</span> format, \</div>
<div class="line">                              (tunnel)-&gt;dst_addr_str, ##__VA_ARGS__); \</div>
<div class="line">                } \</div>
<div class="line">                else \</div>
<div class="line">                { <a class="code" href="log_8h.html#a2e3a398ef2790f21559e37a2a89bbed9">\</a></div>
<div class="line"><a class="code" href="log_8h.html#a2e3a398ef2790f21559e37a2a89bbed9">			trace</a>((prio), format, ##__VA_ARGS__); \</div>
<div class="line">                } \</div>
<div class="line">        } \</div>
<div class="line">        while(0)</div>
<div class="ttc" id="log_8h_html_a2e3a398ef2790f21559e37a2a89bbed9"><div class="ttname"><a href="log_8h.html#a2e3a398ef2790f21559e37a2a89bbed9">trace</a></div><div class="ttdeci">static void trace(int priority, const char *format,...)</div><div class="ttdef"><b>Definition:</b> log.h:32</div></div>
</div><!-- fragment --><p>Print in logs a trace related to the given tunnel </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a9a13a458717d4b79d61e47d68b12bc61"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool callback_rtp_detect </td>
          <td>(</td>
          <td class="paramtype">const unsigned char *const&#160;</td>
          <td class="paramname"><em>ip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *const&#160;</td>
          <td class="paramname"><em>udp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *const&#160;</td>
          <td class="paramname"><em>payload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned int&#160;</td>
          <td class="paramname"><em>payload_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *const&#160;</td>
          <td class="paramname"><em>rtp_private</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The RTP detection callback which do detect RTP stream. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ip</td><td>The inner ip packet </td></tr>
    <tr><td class="paramname">udp</td><td>The udp header of the packet </td></tr>
    <tr><td class="paramname">payload</td><td>The payload of the packet </td></tr>
    <tr><td class="paramname">payload_size</td><td>The size of the payload (in bytes) </td></tr>
    <tr><td class="paramname">rtp_private</td><td>The optional private opaque context to help detecting RTP streams </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the packet is an RTP packet, false otherwise </dd></dl>

</div>
</div>
<a class="anchor" id="ad3f38ead0d7c208d577d03449fe73837"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dump_packet </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>descr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&#160;</td>
          <td class="paramname"><em>length</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Display the content of a IP or ROHC packet. </p>
<p>This function is used for debugging purposes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">descr</td><td>A string that describes the packet </td></tr>
    <tr><td class="paramname">packet</td><td>The packet to display </td></tr>
    <tr><td class="paramname">length</td><td>The length of the packet to display </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a14c44fc16206ae60d53a9650306ddee8"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int gen_false_random_num </td>
          <td>(</td>
          <td class="paramtype">const struct rohc_comp *const&#160;</td>
          <td class="paramname"><em>comp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *const&#160;</td>
          <td class="paramname"><em>user_context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generate a false random number for testing the ROHC library. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">comp</td><td>The ROHC compressor </td></tr>
    <tr><td class="paramname">user_context</td><td>Should always be NULL </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Always 0 </dd></dl>

</div>
</div>
<a class="anchor" id="a4287d18580f3733161df3e25e4fe11ac"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void gnutls_transport_set_ptr_nowarn </td>
          <td>(</td>
          <td class="paramtype">gnutls_session_t&#160;</td>
          <td class="paramname"><em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ptr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a1856ca8ec7babcd859baf97a836ff6f8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool iprohc_tunnel_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structiprohc__tunnel.html">iprohc_tunnel</a> *const&#160;</td>
          <td class="paramname"><em>tunnel</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the given tunnel context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tunnel</td><td>The tunnel context to reset </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the tunnel was successfully reset, false if a problem occurred </dd></dl>

</div>
</div>
<a class="anchor" id="a979506a2f8fea12f982622c384dc509e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool iprohc_tunnel_new </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structiprohc__tunnel.html">iprohc_tunnel</a> *const&#160;</td>
          <td class="paramname"><em>tunnel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structtunnel__params.html">tunnel_params</a>&#160;</td>
          <td class="paramname"><em>params</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint32_t&#160;</td>
          <td class="paramname"><em>local_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>raw_socket</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>tun_fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>base_dev_mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>tun_dev_mtu</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the given tunnel context. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tunnel</td><td>The tunnel context to initialize </td></tr>
    <tr><td class="paramname">params</td><td>The configuration parameters of the tunnel </td></tr>
    <tr><td class="paramname">local_addr</td><td>The local address for tunnel traffic </td></tr>
    <tr><td class="paramname">raw_socket</td><td>The RAW socket to use to send packets to remote endpoint </td></tr>
    <tr><td class="paramname">tun_fd</td><td>The file descriptor of the local TUN interface </td></tr>
    <tr><td class="paramname">base_dev_mtu</td><td>The MTU of the base device used to send packets to the remote endpoint </td></tr>
    <tr><td class="paramname">tun_dev_mtu</td><td>The MTU of the local TUN interface </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if tunnel was successfully initialized, false if a problem occurred </dd></dl>

</div>
</div>
<a class="anchor" id="ad3e0f62cf9f5b5ee048297babd224725"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* iprohc_tunnel_run </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start a new tunnel. </p>
<p>This function is intented to be started as a thread. It will assume that the fields of tunnel are correctly filled, specially that the tun and raw_socket are correctly opened</p>
<p>This function will initialize ROHC contexts and start polling tun and raw socket to compress/decompress the packets via the other functions.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">arg</td><td>A tunnel session </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NULL in case of success, a non-null value otherwise </dd></dl>

</div>
</div>
<a class="anchor" id="aca7867c745d02f334613e5e68edde1a9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void print_rohc_traces </td>
          <td>(</td>
          <td class="paramtype">void *const&#160;</td>
          <td class="paramname"><em>priv_ctxt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const rohc_trace_level_t&#160;</td>
          <td class="paramname"><em>level</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const rohc_trace_entity_t&#160;</td>
          <td class="paramname"><em>entity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>profile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>format</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Callback to print traces of the ROHC library. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">priv_ctxt</td><td>An optional private context, may be NULL </td></tr>
    <tr><td class="paramname">level</td><td>The priority level of the trace </td></tr>
    <tr><td class="paramname">entity</td><td>The entity that emitted the trace among: <ul>
<li>ROHC_TRACE_COMP </li>
<li>ROHC_TRACE_DECOMP </li>
</ul>
</td></tr>
    <tr><td class="paramname">profile</td><td>The ID of the ROHC compression/decompression profile the trace is related to </td></tr>
    <tr><td class="paramname">format</td><td>The format string of the trace </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad4e53dc18a89ea6070247e21051b694e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int raw2tun </td>
          <td>(</td>
          <td class="paramtype">struct rohc_decomp *&#160;</td>
          <td class="paramname"><em>decomp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">in_addr_t&#160;</td>
          <td class="paramname"><em>dst_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structstatitics.html">statitics</a> *&#160;</td>
          <td class="paramname"><em>stats</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Forward ROHC packets received on the RAW socket to the TUN interface. </p>
<p>The function decompresses the ROHC packets thanks to the ROHC library before sending them on the TUN interface.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">decomp</td><td>The ROHC decompressor </td></tr>
    <tr><td class="paramname">dst_addr</td><td>The IP destination address to filter traffic on </td></tr>
    <tr><td class="paramname">from</td><td>The RAW socket descriptor to read from </td></tr>
    <tr><td class="paramname">to</td><td>The TUN file descriptor to write to </td></tr>
    <tr><td class="paramname">mtu</td><td>The MTU (in bytes) of the input interface </td></tr>
    <tr><td class="paramname">stats</td><td>The decompression statistics </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 in case of success, a non-null value otherwise </dd></dl>

</div>
</div>
<a class="anchor" id="a9cca9e8940dd975faa4a0d73cdac12b3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_puree </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>raddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>compressed_packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>total_size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>act_comp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structstatitics.html">statitics</a> *&#160;</td>
          <td class="paramname"><em>stats</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send the current packet. </p>
<p>The function actually send to the RAW socket the send-to-be "floating" packet. It is triggered:</p>
<ul>
<li>when the packet contains <em>packing</em> packets (nominal case)</li>
<li>when including another packet would make this packet too big for MTU</li>
<li>when no packet were sent for 1 seconds</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">to</td><td>The RAW socket descriptor to write to </td></tr>
    <tr><td class="paramname">raddr</td><td>The remote address of the tunnel </td></tr>
    <tr><td class="paramname">mtu</td><td>The MTU of the underlying network interface </td></tr>
    <tr><td class="paramname">compressed_packet</td><td>Pointer to the send-to-be "floating" packet when *act_comp = packing or timeout </td></tr>
    <tr><td class="paramname">total_size</td><td>Pointer to the total size of the send-to-be "floating" packet </td></tr>
    <tr><td class="paramname">act_comp</td><td>Pointer to the current number of packet in packing </td></tr>
    <tr><td class="paramname">stats</td><td>The compression/decompression statistics </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a91ab7441fa2def288ea429cb229484bb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int tun2raw </td>
          <td>(</td>
          <td class="paramtype">struct rohc_comp *&#160;</td>
          <td class="paramname"><em>comp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>from</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>to</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct in_addr&#160;</td>
          <td class="paramname"><em>raddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>mtu</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *const&#160;</td>
          <td class="paramname"><em>packing_frame</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>packing_max_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *const&#160;</td>
          <td class="paramname"><em>packing_cur_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const size_t&#160;</td>
          <td class="paramname"><em>packing_max_pkts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *const&#160;</td>
          <td class="paramname"><em>packing_cur_pkts</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structstatitics.html">statitics</a> *&#160;</td>
          <td class="paramname"><em>stats</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Forward IP packets received on the TUN interface to the RAW socket. </p>
<p>The function compresses the IP packets thanks to the ROHC library before sending them on the RAW socket.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">comp</td><td>The ROHC compressor </td></tr>
    <tr><td class="paramname">from</td><td>The TUN file descriptor to read from </td></tr>
    <tr><td class="paramname">to</td><td>The RAW socket descriptor to write to </td></tr>
    <tr><td class="paramname">raddr</td><td>The remote address of the tunnel </td></tr>
    <tr><td class="paramname">mtu</td><td>The MTU (in bytes) of the output interface </td></tr>
    <tr><td class="paramname">packing_frame</td><td>IN/OUT: The incomplete packing frame being built </td></tr>
    <tr><td class="paramname">packing_max_len</td><td>The max number of bytes in packing frame </td></tr>
    <tr><td class="paramname">packing_cur_len</td><td>IN/OUT: The current number of bytes in packing frame </td></tr>
    <tr><td class="paramname">packing_max_pkts</td><td>The max number of packets in packing frame </td></tr>
    <tr><td class="paramname">packing_cur_pkts</td><td>IN/OUT: The current number of packets in packing frame </td></tr>
    <tr><td class="paramname">stats</td><td>IN/OUT: The statistics of the current tunnel </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 in case of success, a non-null value otherwise </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 12 2016 01:15:17 for IP/ROHC tunnel application by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
